#!/bin/bash
shopt -s extglob

# Author Daniel Vigh #
rm -rf configs
echo -e "Creating backup from packages..."
pacman -Qmq > "aur.pkgs"
pacman -Qeq | grep -v "$(pacman -Qmq)" > "pacman.pkgs"
systemctl list-unit-files --type=service --state=enabled --no-legend | cut -d ' ' -f1 | grep -v getty > "enabled_services"
echo -e "Creating backup from configs...\n"
CONFIGS=(
  "$HOME/.bash_profile"
  "$HOME/.bashrc"
  "$HOME/.config/dunst/dunstrc"
  "$HOME/.dircolors"
  "$HOME/.dircolors_256"
  "$HOME/.fonts.conf"
  "$HOME/.fonts/"
  "$HOME/.gitconfig"
  "$HOME/.gtkrc-2.0"
  "$HOME/.inputrc"
  "$HOME/.moc"
  "$HOME/.vifm"
  "$HOME/.vim/coc-settings.json"
  "$HOME/.config/nvim"
  "$HOME/.xinitrc"
  "$HOME/.alacritty.yml"
  "$HOME/.config/bat"
  /etc/tlp.conf
  /etc/X11/xorg.conf
  /etc/iwd/main.conf
  /etc/makepkg.conf
  /etc/mkinitcpio.conf
  /etc/modprobe.d/
  /etc/pacman.conf
  /etc/pacman.d/mirrorlist
  /etc/sysctl.d/
  /etc/systemd/system/trackpoint_parameters.service
  /usr/local/bin/dwm-statusbar
  /usr/local/bin/passm
  /usr/local/bin/trackpoint_configuration.sh
)
[ ! -e "configs" ] && mkdir "configs"
rm -rf "configs/*"
for f in "${CONFIGS[@]}"; do echo "Backing up of $f..."; rsync -Rr "$f" "configs/"; done
[ -d "configs/home/$USER/.local/share/vifm/Trash" ] && "rm -rf configs/home/$USER/.local/share/vifm/Trash"
[ -f "configs/home/$USER/.bashrc" ] && \
  sed -i '/vighd/d' "configs/home/$USER/.bashrc"
sudo cp /etc/sudoers configs/etc/sudoers
sudo chown vighd:vighd configs/etc/sudoers
sudo chmod 440 configs/etc/sudoers

echo -e "\nDone."
